:- style_check(-discontiguous).
% === col_0 ===
col_0(0).
% === col_1 ===
col_1(1).
% === col_2 ===
col_2(2).
% === col_3 ===
col_3(3).
% === col_4 ===
col_4(4).
% === col_5 ===
col_5(5).
% === col_6 ===
col_6(6).
% === col_7 ===
col_7(7).
% === col_8 ===
col_8(8).
% === col_9 ===
col_9(9).
% === constant ===
constant(p0,pair).
constant(p1,pair).
constant(p2,pair).
constant(0,coord).
constant(1,coord).
constant(2,coord).
constant(3,coord).
constant(4,coord).
constant(5,coord).
constant(6,coord).
constant(7,coord).
constant(8,coord).
constant(9,coord).
constant(10,coord).
constant(11,coord).
constant(12,coord).
constant(13,coord).
constant(14,coord).
constant(15,coord).
constant(0,color).
constant(1,color).
constant(2,color).
constant(3,color).
constant(4,color).
constant(5,color).
constant(6,color).
constant(7,color).
constant(8,color).
constant(9,color).
constant(0,int).
constant(1,int).
constant(2,int).
constant(3,int).
constant(4,int).
constant(5,int).
constant(6,int).
constant(7,int).
constant(8,int).
constant(9,int).
constant(pairid0in3722106093910301873,obj).
constant(pairid0in6999552149255831699,obj).
constant(pairid1in3722106093910301873,obj).
constant(pairid1in6999552149255831699,obj).
constant(pairid2in3722106093910301873,obj).
constant(pairid2in6999552149255831699,obj).
% === inbelongs ===
inbelongs(p0,pairid0in3722106093910301873,0,5).
inbelongs(p0,pairid0in3722106093910301873,1,5).
inbelongs(p0,pairid0in3722106093910301873,0,4).
inbelongs(p0,pairid0in3722106093910301873,1,4).
inbelongs(p0,pairid0in6999552149255831699,1,15).
inbelongs(p0,pairid0in6999552149255831699,1,14).
inbelongs(p0,pairid0in6999552149255831699,2,13).
inbelongs(p0,pairid0in6999552149255831699,2,15).
inbelongs(p0,pairid0in6999552149255831699,3,15).
inbelongs(p0,pairid0in6999552149255831699,3,14).
inbelongs(p0,pairid0in6999552149255831699,1,13).
inbelongs(p0,pairid0in6999552149255831699,2,14).
inbelongs(p0,pairid0in6999552149255831699,3,13).
inbelongs(p0,pairid0in3722106093910301873,4,9).
inbelongs(p0,pairid0in3722106093910301873,5,9).
inbelongs(p0,pairid0in3722106093910301873,4,8).
inbelongs(p0,pairid0in3722106093910301873,5,8).
inbelongs(p0,pairid0in6999552149255831699,7,4).
inbelongs(p0,pairid0in6999552149255831699,8,4).
inbelongs(p0,pairid0in6999552149255831699,8,3).
inbelongs(p0,pairid0in6999552149255831699,6,2).
inbelongs(p0,pairid0in6999552149255831699,7,3).
inbelongs(p0,pairid0in6999552149255831699,7,2).
inbelongs(p0,pairid0in6999552149255831699,8,2).
inbelongs(p0,pairid0in6999552149255831699,6,4).
inbelongs(p0,pairid0in6999552149255831699,6,3).
inbelongs(p0,pairid0in3722106093910301873,6,14).
inbelongs(p0,pairid0in3722106093910301873,7,15).
inbelongs(p0,pairid0in3722106093910301873,6,15).
inbelongs(p0,pairid0in3722106093910301873,7,14).
inbelongs(p0,pairid0in6999552149255831699,7,8).
inbelongs(p0,pairid0in6999552149255831699,8,8).
inbelongs(p0,pairid0in6999552149255831699,8,7).
inbelongs(p0,pairid0in6999552149255831699,9,8).
inbelongs(p0,pairid0in6999552149255831699,7,9).
inbelongs(p0,pairid0in6999552149255831699,8,9).
inbelongs(p0,pairid0in6999552149255831699,7,7).
inbelongs(p0,pairid0in6999552149255831699,9,9).
inbelongs(p0,pairid0in6999552149255831699,9,7).
inbelongs(p0,pairid0in6999552149255831699,14,9).
inbelongs(p0,pairid0in6999552149255831699,15,9).
inbelongs(p0,pairid0in6999552149255831699,13,10).
inbelongs(p0,pairid0in6999552149255831699,14,11).
inbelongs(p0,pairid0in6999552149255831699,13,11).
inbelongs(p0,pairid0in6999552149255831699,15,10).
inbelongs(p0,pairid0in6999552149255831699,13,9).
inbelongs(p0,pairid0in6999552149255831699,14,10).
inbelongs(p0,pairid0in6999552149255831699,15,11).
inbelongs(p0,pairid0in3722106093910301873,14,7).
inbelongs(p0,pairid0in3722106093910301873,15,7).
inbelongs(p0,pairid0in3722106093910301873,14,6).
inbelongs(p0,pairid0in3722106093910301873,15,6).
inbelongs(p1,pairid1in6999552149255831699,2,2).
inbelongs(p1,pairid1in6999552149255831699,4,2).
inbelongs(p1,pairid1in6999552149255831699,4,4).
inbelongs(p1,pairid1in6999552149255831699,3,3).
inbelongs(p1,pairid1in6999552149255831699,3,2).
inbelongs(p1,pairid1in6999552149255831699,2,3).
inbelongs(p1,pairid1in6999552149255831699,3,4).
inbelongs(p1,pairid1in6999552149255831699,2,4).
inbelongs(p1,pairid1in6999552149255831699,4,3).
inbelongs(p1,pairid1in3722106093910301873,2,13).
inbelongs(p1,pairid1in3722106093910301873,3,13).
inbelongs(p1,pairid1in3722106093910301873,2,12).
inbelongs(p1,pairid1in3722106093910301873,3,12).
inbelongs(p1,pairid1in3722106093910301873,9,2).
inbelongs(p1,pairid1in3722106093910301873,9,1).
inbelongs(p1,pairid1in3722106093910301873,10,1).
inbelongs(p1,pairid1in3722106093910301873,10,2).
inbelongs(p1,pairid1in3722106093910301873,10,5).
inbelongs(p1,pairid1in3722106093910301873,9,6).
inbelongs(p1,pairid1in3722106093910301873,10,6).
inbelongs(p1,pairid1in3722106093910301873,9,5).
inbelongs(p1,pairid1in6999552149255831699,13,11).
inbelongs(p1,pairid1in6999552149255831699,11,12).
inbelongs(p1,pairid1in6999552149255831699,13,13).
inbelongs(p1,pairid1in6999552149255831699,12,11).
inbelongs(p1,pairid1in6999552149255831699,11,13).
inbelongs(p1,pairid1in6999552149255831699,12,13).
inbelongs(p1,pairid1in6999552149255831699,11,11).
inbelongs(p1,pairid1in6999552149255831699,13,12).
inbelongs(p1,pairid1in6999552149255831699,12,12).
inbelongs(p1,pairid1in3722106093910301873,15,7).
inbelongs(p1,pairid1in3722106093910301873,14,6).
inbelongs(p1,pairid1in3722106093910301873,15,6).
inbelongs(p1,pairid1in3722106093910301873,14,7).
inbelongs(p2,pairid2in3722106093910301873,0,1).
inbelongs(p2,pairid2in3722106093910301873,1,0).
inbelongs(p2,pairid2in3722106093910301873,0,0).
inbelongs(p2,pairid2in3722106093910301873,1,1).
inbelongs(p2,pairid2in6999552149255831699,2,10).
inbelongs(p2,pairid2in6999552149255831699,2,9).
inbelongs(p2,pairid2in6999552149255831699,3,9).
inbelongs(p2,pairid2in6999552149255831699,1,8).
inbelongs(p2,pairid2in6999552149255831699,1,10).
inbelongs(p2,pairid2in6999552149255831699,2,8).
inbelongs(p2,pairid2in6999552149255831699,3,10).
inbelongs(p2,pairid2in6999552149255831699,1,9).
inbelongs(p2,pairid2in6999552149255831699,3,8).
inbelongs(p2,pairid2in3722106093910301873,5,5).
inbelongs(p2,pairid2in3722106093910301873,4,5).
inbelongs(p2,pairid2in3722106093910301873,4,4).
inbelongs(p2,pairid2in3722106093910301873,5,4).
inbelongs(p2,pairid2in3722106093910301873,7,14).
inbelongs(p2,pairid2in3722106093910301873,6,14).
inbelongs(p2,pairid2in3722106093910301873,7,15).
inbelongs(p2,pairid2in3722106093910301873,6,15).
inbelongs(p2,pairid2in6999552149255831699,9,4).
inbelongs(p2,pairid2in6999552149255831699,7,3).
inbelongs(p2,pairid2in6999552149255831699,7,2).
inbelongs(p2,pairid2in6999552149255831699,8,2).
inbelongs(p2,pairid2in6999552149255831699,9,3).
inbelongs(p2,pairid2in6999552149255831699,8,4).
inbelongs(p2,pairid2in6999552149255831699,9,2).
inbelongs(p2,pairid2in6999552149255831699,7,4).
inbelongs(p2,pairid2in6999552149255831699,8,3).
inbelongs(p2,pairid2in3722106093910301873,8,7).
inbelongs(p2,pairid2in3722106093910301873,7,8).
inbelongs(p2,pairid2in3722106093910301873,8,8).
inbelongs(p2,pairid2in3722106093910301873,7,7).
inbelongs(p2,pairid2in3722106093910301873,12,12).
inbelongs(p2,pairid2in3722106093910301873,13,13).
inbelongs(p2,pairid2in3722106093910301873,13,12).
inbelongs(p2,pairid2in3722106093910301873,12,13).
inbelongs(p2,pairid2in3722106093910301873,14,7).
inbelongs(p2,pairid2in3722106093910301873,13,8).
inbelongs(p2,pairid2in3722106093910301873,13,7).
inbelongs(p2,pairid2in3722106093910301873,14,8).
% === inpix ===
inpix(p0,0,4,9).
inpix(p0,0,5,9).
inpix(p0,1,4,9).
inpix(p0,1,5,9).
inpix(p0,1,13,3).
inpix(p0,1,14,3).
inpix(p0,1,15,3).
inpix(p0,2,13,3).
inpix(p0,2,14,3).
inpix(p0,2,15,3).
inpix(p0,3,13,3).
inpix(p0,3,14,3).
inpix(p0,3,15,3).
inpix(p0,4,8,9).
inpix(p0,4,9,9).
inpix(p0,5,8,9).
inpix(p0,5,9,9).
inpix(p0,6,2,1).
inpix(p0,6,3,1).
inpix(p0,6,4,1).
inpix(p0,6,14,4).
inpix(p0,6,15,4).
inpix(p0,7,2,1).
inpix(p0,7,3,1).
inpix(p0,7,4,1).
inpix(p0,7,7,3).
inpix(p0,7,8,3).
inpix(p0,7,9,3).
inpix(p0,7,14,4).
inpix(p0,7,15,4).
inpix(p0,8,2,1).
inpix(p0,8,3,1).
inpix(p0,8,4,1).
inpix(p0,8,7,3).
inpix(p0,8,8,3).
inpix(p0,8,9,3).
inpix(p0,9,7,3).
inpix(p0,9,8,3).
inpix(p0,9,9,3).
inpix(p0,13,9,1).
inpix(p0,13,10,1).
inpix(p0,13,11,1).
inpix(p0,14,6,4).
inpix(p0,14,7,4).
inpix(p0,14,9,1).
inpix(p0,14,10,1).
inpix(p0,14,11,1).
inpix(p0,15,6,4).
inpix(p0,15,7,4).
inpix(p0,15,9,1).
inpix(p0,15,10,1).
inpix(p0,15,11,1).
inpix(p1,2,2,8).
inpix(p1,2,3,8).
inpix(p1,2,4,8).
inpix(p1,2,12,4).
inpix(p1,2,13,4).
inpix(p1,3,2,8).
inpix(p1,3,3,8).
inpix(p1,3,4,8).
inpix(p1,3,12,4).
inpix(p1,3,13,4).
inpix(p1,4,2,8).
inpix(p1,4,3,8).
inpix(p1,4,4,8).
inpix(p1,9,1,9).
inpix(p1,9,2,9).
inpix(p1,9,5,4).
inpix(p1,9,6,4).
inpix(p1,10,1,9).
inpix(p1,10,2,9).
inpix(p1,10,5,4).
inpix(p1,10,6,4).
inpix(p1,11,11,8).
inpix(p1,11,12,8).
inpix(p1,11,13,8).
inpix(p1,12,11,8).
inpix(p1,12,12,8).
inpix(p1,12,13,8).
inpix(p1,13,11,8).
inpix(p1,13,12,8).
inpix(p1,13,13,8).
inpix(p1,14,6,9).
inpix(p1,14,7,9).
inpix(p1,15,6,9).
inpix(p1,15,7,9).
inpix(p2,0,0,0).
inpix(p2,0,1,0).
inpix(p2,1,0,0).
inpix(p2,1,1,0).
inpix(p2,1,8,9).
inpix(p2,1,9,9).
inpix(p2,1,10,9).
inpix(p2,2,8,9).
inpix(p2,2,9,9).
inpix(p2,2,10,9).
inpix(p2,3,8,9).
inpix(p2,3,9,9).
inpix(p2,3,10,9).
inpix(p2,4,4,0).
inpix(p2,4,5,0).
inpix(p2,5,4,0).
inpix(p2,5,5,0).
inpix(p2,6,14,5).
inpix(p2,6,15,5).
inpix(p2,7,2,9).
inpix(p2,7,3,9).
inpix(p2,7,4,9).
inpix(p2,7,7,3).
inpix(p2,7,8,3).
inpix(p2,7,14,5).
inpix(p2,7,15,5).
inpix(p2,8,2,9).
inpix(p2,8,3,9).
inpix(p2,8,4,9).
inpix(p2,8,7,3).
inpix(p2,8,8,3).
inpix(p2,9,2,9).
inpix(p2,9,3,9).
inpix(p2,9,4,9).
inpix(p2,12,12,3).
inpix(p2,12,13,3).
inpix(p2,13,7,5).
inpix(p2,13,8,5).
inpix(p2,13,12,3).
inpix(p2,13,13,3).
inpix(p2,14,7,5).
inpix(p2,14,8,5).
% === int_0 ===
int_0(0).
% === int_1 ===
int_1(1).
% === int_2 ===
int_2(2).
% === int_3 ===
int_3(3).
% === int_4 ===
int_4(4).
% === int_5 ===
int_5(5).
% === int_6 ===
int_6(6).
% === int_7 ===
int_7(7).
% === int_8 ===
int_8(8).
% === int_9 ===
int_9(9).
% === is_color_obj ===
is_color_obj(p0,pairid0in3722106093910301873,9).
is_color_obj(p0,pairid0in6999552149255831699,3).
is_color_obj(p0,pairid0in3722106093910301873,9).
is_color_obj(p0,pairid0in6999552149255831699,1).
is_color_obj(p0,pairid0in3722106093910301873,4).
is_color_obj(p0,pairid0in6999552149255831699,3).
is_color_obj(p0,pairid0in6999552149255831699,1).
is_color_obj(p0,pairid0in3722106093910301873,4).
is_color_obj(p1,pairid1in6999552149255831699,8).
is_color_obj(p1,pairid1in3722106093910301873,4).
is_color_obj(p1,pairid1in3722106093910301873,9).
is_color_obj(p1,pairid1in3722106093910301873,4).
is_color_obj(p1,pairid1in6999552149255831699,8).
is_color_obj(p1,pairid1in3722106093910301873,9).
is_color_obj(p2,pairid2in3722106093910301873,0).
is_color_obj(p2,pairid2in6999552149255831699,9).
is_color_obj(p2,pairid2in3722106093910301873,0).
is_color_obj(p2,pairid2in6999552149255831699,9).
is_color_obj(p2,pairid2in3722106093910301873,3).
is_color_obj(p2,pairid2in3722106093910301873,3).
% === is_gray_obj ===
is_gray_obj(p2,pairid2in3722106093910301873,5).
is_gray_obj(p2,pairid2in3722106093910301873,5).
% === objholes ===
objholes(p0,pairid0in6999552149255831699,0).
objholes(p0,pairid0in6999552149255831699,0).
objholes(p0,pairid0in6999552149255831699,0).
objholes(p0,pairid0in6999552149255831699,0).
objholes(p1,pairid1in6999552149255831699,0).
objholes(p1,pairid1in6999552149255831699,0).
objholes(p2,pairid2in6999552149255831699,0).
objholes(p2,pairid2in6999552149255831699,0).

% 安全算术/比较
sub(A,B,C):- integer(A),integer(B), C is A-B.
abs_val(A,B):- integer(A), B is abs(A).
geq(A,B):- integer(A),integer(B), A>=B.
leq(A,B):- integer(A),integer(B), A=<B.
eq(A,B):- integer(A),integer(B), A=:=B.

same_sign(A,B):- int_0(Z), geq(A,Z), geq(B,Z).
same_sign(A,B):- int_0(Z), leq(A,Z), leq(B,Z).

lex_leq(X1,Y1,X2,Y2):- X1<X2 ; (X1=:=X2, Y1=<Y2).

safe_mod(A,B,R):- integer(A), integer(B), B>0, R is A mod B.  % SWI 文档见 mod/2

% step(1). step(2). step(3). step(4). step(5).

signum(N,S) :- N > 0, !, S = 1.
signum(N,S) :- N < 0, !, S = -1.
signum(_,0).

% 含步长 S 的 45° 连线（含端点）
% 只依赖 SWI 的算术与 between/3；不依赖 same_sign/safe_mod 等
on_diag_between_k(X,Y,X1,Y1,X2,Y2,S):-
  integer(S), S >= 1,
  DXe is X2 - X1,
  DYe is Y2 - Y1,
  ADx is abs(DXe),
  ADy is abs(DYe),
  ADx =:= ADy,                % 必须 45°
  signum(DXe,Sx),
  signum(DYe,Sy),
  between(0, ADx, K),         % K=0..ADx（含端点）
  0 is K mod S,               % 步长整除
  X is X1 + K*Sx,
  Y is Y1 + K*Sy.

% 端点配对（像素级，等长=45°），Chebyshev 距离 d∞ = max(|dx|,|dy|)
diag_pair_near(P,C,X1,Y1,X2,Y2) :-             % 最近
  inpix(P,X1,Y1,C), inpix(P,X2,Y2,C), lex_leq(X1,Y1,X2,Y2),
  sub(X2,X1,DX), sub(Y2,Y1,DY), abs_val(DX,ADx), abs_val(DY,ADy), ADx=:=ADy,
  % 不存在更近的一对
  \+ (inpix(P,U1,V1,C), inpix(P,U2,V2,C), lex_leq(U1,V1,U2,V2),
      sub(U2,U1,DX2), sub(V2,V1,DY2), abs_val(DX2,A2), abs_val(DY2,B2),
      A2=:=B2, max(A2,B2) < ADx).

diag_pair_far(P,C,X1,Y1,X2,Y2) :-              % 最远
  inpix(P,X1,Y1,C), inpix(P,X2,Y2,C), lex_leq(X1,Y1,X2,Y2),
  sub(X2,X1,DX), sub(Y2,Y1,DY), abs_val(DX,ADx), abs_val(DY,ADy), ADx=:=ADy,
  % 不存在更远的一对
  \+ (inpix(P,U1,V1,C), inpix(P,U2,V2,C), lex_leq(U1,V1,U2,V2),
      sub(U2,U1,DX2), sub(V2,V1,DY2), abs_val(DX2,A2), abs_val(DY2,B2),
      A2=:=B2, max(A2,B2) > ADx).
