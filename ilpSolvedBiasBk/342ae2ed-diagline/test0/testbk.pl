:- style_check(-discontiguous).
% === col_0 ===
col_0(0).
% === col_1 ===
col_1(1).
% === col_2 ===
col_2(2).
% === col_3 ===
col_3(3).
% === col_4 ===
col_4(4).
% === col_5 ===
col_5(5).
% === col_6 ===
col_6(6).
% === col_7 ===
col_7(7).
% === col_8 ===
col_8(8).
% === col_9 ===
col_9(9).
% === constant ===
constant(p0,pair).
constant(0,coord).
constant(1,coord).
constant(2,coord).
constant(3,coord).
constant(4,coord).
constant(5,coord).
constant(6,coord).
constant(7,coord).
constant(8,coord).
constant(9,coord).
constant(10,coord).
constant(11,coord).
constant(12,coord).
constant(13,coord).
constant(14,coord).
constant(15,coord).
constant(0,color).
constant(1,color).
constant(2,color).
constant(3,color).
constant(4,color).
constant(5,color).
constant(6,color).
constant(7,color).
constant(8,color).
constant(9,color).
constant(0,int).
constant(1,int).
constant(2,int).
constant(3,int).
constant(4,int).
constant(5,int).
constant(6,int).
constant(7,int).
constant(8,int).
constant(9,int).
constant(pairid0in3722106093910301873,obj).
constant(pairid0in6999552149255831699,obj).
% === inbelongs ===
inbelongs(p0,pairid0in3722106093910301873,0,10).
inbelongs(p0,pairid0in3722106093910301873,1,10).
inbelongs(p0,pairid0in3722106093910301873,0,9).
inbelongs(p0,pairid0in3722106093910301873,1,9).
inbelongs(p0,pairid0in3722106093910301873,3,10).
inbelongs(p0,pairid0in3722106093910301873,4,11).
inbelongs(p0,pairid0in3722106093910301873,4,10).
inbelongs(p0,pairid0in3722106093910301873,3,11).
inbelongs(p0,pairid0in3722106093910301873,4,5).
inbelongs(p0,pairid0in3722106093910301873,4,6).
inbelongs(p0,pairid0in3722106093910301873,5,6).
inbelongs(p0,pairid0in3722106093910301873,5,5).
inbelongs(p0,pairid0in3722106093910301873,5,3).
inbelongs(p0,pairid0in3722106093910301873,5,2).
inbelongs(p0,pairid0in3722106093910301873,6,3).
inbelongs(p0,pairid0in3722106093910301873,6,2).
inbelongs(p0,pairid0in6999552149255831699,7,8).
inbelongs(p0,pairid0in6999552149255831699,8,8).
inbelongs(p0,pairid0in6999552149255831699,6,9).
inbelongs(p0,pairid0in6999552149255831699,7,10).
inbelongs(p0,pairid0in6999552149255831699,7,9).
inbelongs(p0,pairid0in6999552149255831699,8,9).
inbelongs(p0,pairid0in6999552149255831699,6,8).
inbelongs(p0,pairid0in6999552149255831699,6,10).
inbelongs(p0,pairid0in6999552149255831699,8,10).
inbelongs(p0,pairid0in3722106093910301873,7,15).
inbelongs(p0,pairid0in3722106093910301873,8,15).
inbelongs(p0,pairid0in3722106093910301873,7,14).
inbelongs(p0,pairid0in3722106093910301873,8,14).
inbelongs(p0,pairid0in3722106093910301873,11,14).
inbelongs(p0,pairid0in3722106093910301873,11,13).
inbelongs(p0,pairid0in3722106093910301873,10,13).
inbelongs(p0,pairid0in3722106093910301873,10,14).
inbelongs(p0,pairid0in3722106093910301873,11,8).
inbelongs(p0,pairid0in3722106093910301873,12,8).
inbelongs(p0,pairid0in3722106093910301873,12,9).
inbelongs(p0,pairid0in3722106093910301873,11,9).
inbelongs(p0,pairid0in6999552149255831699,13,2).
inbelongs(p0,pairid0in6999552149255831699,15,3).
inbelongs(p0,pairid0in6999552149255831699,14,1).
inbelongs(p0,pairid0in6999552149255831699,15,1).
inbelongs(p0,pairid0in6999552149255831699,13,3).
inbelongs(p0,pairid0in6999552149255831699,14,3).
inbelongs(p0,pairid0in6999552149255831699,13,1).
inbelongs(p0,pairid0in6999552149255831699,14,2).
inbelongs(p0,pairid0in6999552149255831699,15,2).
inbelongs(p0,pairid0in3722106093910301873,14,9).
inbelongs(p0,pairid0in3722106093910301873,15,9).
inbelongs(p0,pairid0in3722106093910301873,14,10).
inbelongs(p0,pairid0in3722106093910301873,15,10).
% === inpix ===
inpix(p0,0,9,4).
inpix(p0,0,10,4).
inpix(p0,1,9,4).
inpix(p0,1,10,4).
inpix(p0,3,10,1).
inpix(p0,3,11,1).
inpix(p0,4,5,4).
inpix(p0,4,6,4).
inpix(p0,4,10,1).
inpix(p0,4,11,1).
inpix(p0,5,2,6).
inpix(p0,5,3,6).
inpix(p0,5,5,4).
inpix(p0,5,6,4).
inpix(p0,6,2,6).
inpix(p0,6,3,6).
inpix(p0,6,8,8).
inpix(p0,6,9,8).
inpix(p0,6,10,8).
inpix(p0,7,8,8).
inpix(p0,7,9,8).
inpix(p0,7,10,8).
inpix(p0,7,14,1).
inpix(p0,7,15,1).
inpix(p0,8,8,8).
inpix(p0,8,9,8).
inpix(p0,8,10,8).
inpix(p0,8,14,1).
inpix(p0,8,15,1).
inpix(p0,10,13,3).
inpix(p0,10,14,3).
inpix(p0,11,8,6).
inpix(p0,11,9,6).
inpix(p0,11,13,3).
inpix(p0,11,14,3).
inpix(p0,12,8,6).
inpix(p0,12,9,6).
inpix(p0,13,1,8).
inpix(p0,13,2,8).
inpix(p0,13,3,8).
inpix(p0,14,1,8).
inpix(p0,14,2,8).
inpix(p0,14,3,8).
inpix(p0,14,9,3).
inpix(p0,14,10,3).
inpix(p0,15,1,8).
inpix(p0,15,2,8).
inpix(p0,15,3,8).
inpix(p0,15,9,3).
inpix(p0,15,10,3).
% === int_0 ===
int_0(0).
% === int_1 ===
int_1(1).
% === int_2 ===
int_2(2).
% === int_3 ===
int_3(3).
% === int_4 ===
int_4(4).
% === int_5 ===
int_5(5).
% === int_6 ===
int_6(6).
% === int_7 ===
int_7(7).
% === int_8 ===
int_8(8).
% === int_9 ===
int_9(9).
% === is_color_obj ===
is_color_obj(p0,pairid0in3722106093910301873,4).
is_color_obj(p0,pairid0in3722106093910301873,1).
is_color_obj(p0,pairid0in3722106093910301873,4).
is_color_obj(p0,pairid0in3722106093910301873,6).
is_color_obj(p0,pairid0in6999552149255831699,8).
is_color_obj(p0,pairid0in3722106093910301873,1).
is_color_obj(p0,pairid0in3722106093910301873,3).
is_color_obj(p0,pairid0in3722106093910301873,6).
is_color_obj(p0,pairid0in6999552149255831699,8).
is_color_obj(p0,pairid0in3722106093910301873,3).
% === objholes ===
objholes(p0,pairid0in6999552149255831699,0).
objholes(p0,pairid0in6999552149255831699,0).

% 安全算术/比较
sub(A,B,C):- integer(A),integer(B), C is A-B.
abs_val(A,B):- integer(A), B is abs(A).
geq(A,B):- integer(A),integer(B), A>=B.
leq(A,B):- integer(A),integer(B), A=<B.
eq(A,B):- integer(A),integer(B), A=:=B.

same_sign(A,B):- int_0(Z), geq(A,Z), geq(B,Z).
same_sign(A,B):- int_0(Z), leq(A,Z), leq(B,Z).

lex_leq(X1,Y1,X2,Y2):- X1<X2 ; (X1=:=X2, Y1=<Y2).

safe_mod(A,B,R):- integer(A), integer(B), B>0, R is A mod B.  % SWI 文档见 mod/2

% step(1). step(2). step(3). step(4). step(5).

signum(N,S) :- N > 0, !, S = 1.
signum(N,S) :- N < 0, !, S = -1.
signum(_,0).

% 含步长 S 的 45° 连线（含端点）
% 只依赖 SWI 的算术与 between/3；不依赖 same_sign/safe_mod 等
on_diag_between_k(X,Y,X1,Y1,X2,Y2,S):-
  integer(S), S >= 1,
  DXe is X2 - X1,
  DYe is Y2 - Y1,
  ADx is abs(DXe),
  ADy is abs(DYe),
  ADx =:= ADy,                % 必须 45°
  signum(DXe,Sx),
  signum(DYe,Sy),
  between(0, ADx, K),         % K=0..ADx（含端点）
  0 is K mod S,               % 步长整除
  X is X1 + K*Sx,
  Y is Y1 + K*Sy.

% 端点配对（像素级，等长=45°），Chebyshev 距离 d∞ = max(|dx|,|dy|)
diag_pair_near(P,C,X1,Y1,X2,Y2) :-             % 最近
  inpix(P,X1,Y1,C), inpix(P,X2,Y2,C), lex_leq(X1,Y1,X2,Y2),
  sub(X2,X1,DX), sub(Y2,Y1,DY), abs_val(DX,ADx), abs_val(DY,ADy), ADx=:=ADy,
  % 不存在更近的一对
  \+ (inpix(P,U1,V1,C), inpix(P,U2,V2,C), lex_leq(U1,V1,U2,V2),
      sub(U2,U1,DX2), sub(V2,V1,DY2), abs_val(DX2,A2), abs_val(DY2,B2),
      A2=:=B2, max(A2,B2) < ADx).

diag_pair_far(P,C,X1,Y1,X2,Y2) :-              % 最远
  inpix(P,X1,Y1,C), inpix(P,X2,Y2,C), lex_leq(X1,Y1,X2,Y2),
  sub(X2,X1,DX), sub(Y2,Y1,DY), abs_val(DX,ADx), abs_val(DY,ADy), ADx=:=ADy,
  % 不存在更远的一对
  \+ (inpix(P,U1,V1,C), inpix(P,U2,V2,C), lex_leq(U1,V1,U2,V2),
      sub(U2,U1,DX2), sub(V2,V1,DY2), abs_val(DX2,A2), abs_val(DY2,B2),
      A2=:=B2, max(A2,B2) > ADx).
